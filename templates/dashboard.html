<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>MBTA Frequent Bus Route Headways Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 2rem;
            background: #e5e5e5;
        }
        h1 {
            color: #ffffff;
        }
        .header-bar {
            position: sticky;
            top: 0;
            z-index: 1000;
            background-color: #14213d;
            padding: 1rem 2rem;
            margin: -2rem -2rem 2rem -2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .header-bar h1 {
            margin-top: 0;
            margin-bottom: 1rem;
        }
        .tabs {
            margin-bottom: 0;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            margin-right: 1rem;
            cursor: pointer;
            border: none;
            background-color: #e5e5e5;
            border-radius: 5px;
        }
        .tab-button.active {
            background-color: #fca311;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .chart {
            margin-bottom: 3rem;
        }
        .chart-row {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }
        .chart-row .chart {
            flex: 1;
            min-width: 300px;
            max-width: 100%;
            width: 100%;
        }
        .chart > div {
            width: 100% !important;
        }
        .about-content {
            max-width: 700px;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            line-height: 1.6;
        }
        .about-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1rem auto;
        }

        @media (max-width: 768px) {
            .chart-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <h1>ðŸšŒ MBTA Frequent Bus Route Headways Dashboard</h1>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab(event, 'tracker')"><strong>Tracker</strong></button>
            <button class="tab-button" onclick="showTab(event, 'about')"><strong>About</strong></button>
        </div>
    </div>

    <!-- Tracker Tab -->
    <div id="tracker" class="tab-content active">
        <p>Last updated: {{ updated }}</p>
        <p>Select routes and stops in the legend to include them in the plot. Double-click to show all routes or only one route.</p>

        <div class="chart">
            {{ scatter_plot_headways_first_last | safe }}
        </div>

        <div class="chart-row">
            <div class="chart">
                {{ bar_chart_headways_frequency_threshold | safe }}
            </div>

            <div class="chart">
                {{ histogram_headways_distribution | safe }}
            </div>
        </div>
    </div>

    <!-- About Tab -->
    <div id="about" class="tab-content">
        <div class="about-content">
            <h2 id="introduction">Introduction</h2>
                <p>The MBTA is introducing frequent bus routes as part of its
                <a href="https://www.mbta.com/projects/bus-network-redesign">Bus Network Redesign</a> project. Between 2024 and 2029, it aims to
                increase service frequency on eighteen key routes to every 15 minutes or less between 5:00am and 1:00am, 7 days per week.
                As of August 24, 2025, the <strong>1, 15, 22, 23, 28, 31, 104, 109, 110</strong> and <strong>116</strong> buses have been designated as frequent
                routes.</p>
                <p>The map of the eighteen frequent routes is below:</p>
                <p><img src="https://cdn.mbta.com/sites/default/files/styles/max_2600x2600/public/media/2024-03/2024-3-25-proposed-frequent-bus-routes-map.png?itok=dgVotJ0c" alt="Frequent Bus Route Map">
                <em>Source: <a href="https://www.mbta.com/projects/bus-network-redesign/new-bus-network-map">MBTA</a></em></p>
            <h2 id="purpose">Purpose</h2>
                <p><strong>Reliable, frequent service</strong> is critical for the success of a public transit system. People need to feel confident
                that buses will arrive and depart on time, when they need them, so they can plan around them. Without this confidence,
                people will use other transportation modes if they have the choice, or lose time and miss opportunities if they don&#39;t.</p>
                <p>The frequent bus routes are an important step in the right direction. A person arriving at a bus stop at a random time
                can expect an average wait time of 7.5 minutes on frequent routes. This is likely to be an
                <a href="https://www.academia.edu/download/102559117/pdf.pdf">acceptable wait time</a> under many conditions.</p>
                <p><strong>This tracker provides</strong> an easy way to see how well the frequent bus routes are meeting their promised headways of 15
                minutes or less. This can be compared to public perceptions of bus service quality to better understand what is needed
                to encourage greater ridership.</p>
                <p>This tool is meant to be an informative resource, and is not intended as criticism of the MBTA.</p>
            <h2 id="method">Method</h2>
                <p>The MBTA shares real-time vehicle positions over an <a href="https://www.mbta.com/developers/v3-api">API</a> that follows the
                <a href="https://gtfs.org/documentation/schedule/reference/">General Transit Feed Specification</a> (GTFS). This tracker
                <a href="https://www.mbta.com/developers/v3-api/streaming">streams</a> data from the API to reduce the chance of missing stop
                events.</p>
                <p><strong>Stop events</strong> are recorded when a bus departs a stop. This is indicated by the vehicle&#39;s current stop_id changing.
                Any stops on non-revenue trips are omitted.</p>
                <p><strong>Headways</strong> are the time between consecutive stop events on the same route at a given bus stop. Long headways
                (&gt;120 minutes) between scheduled service periods are omitted.</p>
            <h2 id="plots">Plots</h2>
                <p>The scatter plot at the top of the page shows actual headways at the first and last stops of frequent routes. Headways
                at the first stop should meet the 15-minute target most frequently because there are few delays introduced by traffic or
                boarding &amp; alighting. Headways at the last stop show the accumulation of all delays along the route. If headways meet
                the target here, they were likely met at intermediate stops.</p>
                <p>The bar chart shows the proportion of headways on each route that meet the 15-minute target. This includes headways from
                all stops along the route, not just the first and last.</p>
                <p>The histogram shows the distribution and frequency of headways on each route. It is important to consider how far off
                the target these headways are. Frequent 16-minute headways are much less impactful to a rider than occasional 30-minute
                headways. Again, this includes headways from all stops along the route.</p>
        </div>
    </div>

    <script>
        function showTab(event, tabId) {
            const tabs = document.querySelectorAll(".tab-content");
            const buttons = document.querySelectorAll(".tab-button");

            tabs.forEach(tab => tab.classList.remove("active"));
            buttons.forEach(btn => btn.classList.remove("active"));

            const newTab = document.getElementById(tabId);
            newTab.classList.add("active");
            event.target.classList.add("active");

            setTimeout(() => {
                const charts = newTab.querySelectorAll(".chart div.js-plotly-plot");
                charts.forEach(chart => {
                    Plotly.Plots.resize(chart);
                });
            }, 100);
        }
    </script>
    <script>
        window.addEventListener("load", () => {
            setTimeout(() => {
                document.querySelectorAll(".js-plotly-plot").forEach(chart => {
                    Plotly.Plots.resize(chart);
                });
            }, 300);
        });
    </script>
</body>
</html>
